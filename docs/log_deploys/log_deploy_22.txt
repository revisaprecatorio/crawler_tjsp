Vejo que o certificado foi configurado corretamente, mas ainda est√° dando erro de autentica√ß√£o. O problema √© que o certificado .pfx precisa ser carregado no navegador Chrome do Selenium Grid, n√£o apenas estar presente no filesystem.

Vamos investigar e corrigir. Primeiro, vamos ver os screenshots de erro para entender o que est√° acontecendo:

üîç DIAGN√ìSTICO
bash
# Na VPS, verificar screenshots de erro
ls -lh /opt/crawler_tjsp/screenshots/erro_*_20251001_1949*.png

# Ver HTML do erro (para entender o que o site est√° mostrando)
cat /opt/crawler_tjsp/screenshots/erro_0223266_55_2021_8_26_0500_20251001_194944.html | head -50
üîß PROBLEMA IDENTIFICADO
O certificado .pfx est√° no worker, mas o Chrome roda no container Selenium Grid. Precisamos:

Copiar o certificado para o Selenium Grid, OU
Converter .pfx para .pem e configurar no Chrome, OU
Usar autentica√ß√£o por login/senha (mais simples)
üí° SOLU√á√ÉO RECOMENDADA: Verificar o C√≥digo
Vamos ver como o 
crawler_full.py
 est√° tentando usar o certificado:

bash
# Na VPS
grep -n "CERT_PATH\|cert_path\|pfx" /opt/crawler_tjsp/crawler_full.py | head -20
Me envie o output para eu ver como o c√≥digo est√° configurado.

üîÑ ALTERNATIVA TEMPOR√ÅRIA: Login com CPF/Senha
Se o site TJSP aceitar login com CPF/senha (al√©m de certificado), podemos testar assim:

bash
# Editar .env
nano /opt/crawler_tjsp/.env
Adicionar:

bash
# Autentica√ß√£o CAS (alternativa ao certificado)
CAS_USUARIO=51764890230
CAS_SENHA=SUA_SENHA_AQUI
Reiniciar:

bash
docker compose restart worker
üìä PR√ìXIMOS PASSOS
Execute estes comandos e me envie os outputs:

bash
# 1. Ver como o c√≥digo usa o certificado
grep -A 10 "CERT_PATH" /opt/crawler_tjsp/crawler_full.py

# 2. Ver fun√ß√£o de login CAS
grep -A 30 "_maybe_cas_login" /opt/crawler_tjsp/crawler_full.py | head -50

# 3. Ver screenshot de erro (se poss√≠vel, baixar e visualizar)
ls -lh /opt/crawler_tjsp/screenshots/erro_*_20251001_1949*.png
Qual voc√™ prefere:

Investigar o c√≥digo para corrigir o certificado?
Tentar login com CPF/senha (se voc√™ tiver)?
Baixar e analisar os screenshots de erro?

--- EXEC --- 

root@srv987902:/opt/crawler_tjsp# grep -A 10 "CERT_PATH" /opt/crawler_tjsp/crawler_full.py
root@srv987902:/opt/crawler_tjsp# grep -A 30 "_maybe_cas_login" /opt/crawler_tjsp/crawler_full.py | head -50
def _maybe_cas_login(wait, driver, cert_subject_cn, user=None, pwd=None, payload=None):
    if "sajcas/login" not in (driver.current_url or ""):
        debug(payload, "CAS: n√£o precisou logar (j√° dentro).")
        return
    try:
        debug(payload, "CAS: tentando aba CERTIFICADO‚Ä¶")
        _switch_to_tab(wait, (By.ID, "linkAbaCertificado"))
        wait.until(EC.presence_of_element_located((By.ID, "certificados")))
        def options_ready(drv):
            try:
                els = drv.find_elements(By.CSS_SELECTOR, "#certificados option")
                if not els: return False
                first = (els[0].text or "").strip().lower()
                return not (len(els) == 1 and "carregando" in first)
            except: return False
        wait.until(options_ready)
        subj_hint = cert_subject_cn.split(":")[0].strip() if cert_subject_cn else None
        def pick():
            els = driver.find_elements(By.CSS_SELECTOR, "#certificados option"); ch = None
            if subj_hint:
                for o in els:
                    if subj_hint.lower() in ((o.text or "").lower()): ch = o; break
            if not ch:
                for o in els:
                    if (o.get_attribute("value") or '').strip(): ch = o; break
            return ch
        ch = pick()
        if not ch: raise RuntimeError("CAS: nenhum certificado dispon√≠vel.")
        driver.execute_script("""
            const opt=arguments[0], sel=document.querySelector('#certificados');
            sel.value=opt.value; sel.dispatchEvent(new Event('change',{bubbles:true}));
--
        _maybe_cas_login(wait, driver, cert_subject_cn, user=cas_usuario, pwd=cas_senha, payload=payload)

        if process_number:
            _select_criterio_processo(wait, driver, process_number)
        else:
            _select_criterio_documento(wait, driver)
            inp = wait.until(EC.visibility_of_element_located((By.ID, "campo_DOCPARTE")))
            inp.clear(); inp.send_keys(doc_number)

        if not _submit_consulta(wait, driver, payload):
            raise TimeoutException("N√£o consegui acionar o 'Consultar'.")
        debug(payload, "Consulta enviada.")

        kind = _wait_result_page(driver, timeout=60, payload=payload)
        if kind == "lista":
            processos = driver.find_elements(By.CSS_SELECTOR, "a.linkProcesso, a[class*='numeroProcesso']")
            found = _extract_process_numbers_from_elements(processos)
            debug(payload, f"Resultados (lista): {len(found)} processo(s).")
root@srv987902:/opt/crawler_tjsp# ls -lh /opt/crawler_tjsp/screenshots/erro_*_20251001_1949*.png
-rw-r--r-- 1 root root 63K Oct  1 22:49 /opt/crawler_tjsp/screenshots/erro_0179487_50_2021_8_26_0500_20251001_194950.png
-rw-r--r-- 1 root root 63K Oct  1 22:49 /opt/crawler_tjsp/screenshots/erro_0223266_55_2021_8_26_0500_20251001_194944.png
-rw-r--r-- 1 root root 63K Oct  1 22:49 /opt/crawler_tjsp/screenshots/erro_7007473_24_2010_8_26_0500_20251001_194957.png
root@srv987902:/opt/crawler_tjsp# 


Perfeito! Agora entendi o problema. O c√≥digo j√° est√° preparado para usar certificado, mas ele espera que o certificado esteja instalado no navegador Chrome, n√£o apenas o arquivo .pfx no filesystem.

Vejo no c√≥digo que ele tenta:

Clicar na aba "CERTIFICADO"
Selecionar um certificado da lista
Mas n√£o encontra nenhum certificado dispon√≠vel ‚Üí "CAS: nenhum certificado dispon√≠vel."
üîß PROBLEMA REAL
O certificado .pfx est√° no worker, mas o Chrome roda no Selenium Grid. O Selenium Grid n√£o tem acesso ao arquivo .pfx e n√£o pode carregar o certificado automaticamente.

üí° SOLU√á√ïES POSS√çVEIS
Op√ß√£o 1: Usar Login com CPF/Senha (MAIS SIMPLES)
Se o site aceitar login com CPF/senha, √© a solu√ß√£o mais r√°pida:

bash
# Na VPS
nano /opt/crawler_tjsp/.env
Adicionar ao final do arquivo:

bash
# Autentica√ß√£o CAS com CPF/Senha
CAS_USUARIO=51764890230
CAS_SENHA=SUA_SENHA_AQUI
Salvar e reiniciar:

bash
docker compose restart worker
Op√ß√£o 2: Configurar Certificado no Selenium Grid (COMPLEXO)
Precisaria:

Converter .pfx para formato que o Chrome aceita
Montar volume no Selenium Grid
Configurar Chrome para usar o certificado
Isso √© mais complexo e pode n√£o funcionar bem com Selenium Grid.

üéØ RECOMENDA√á√ÉO
Voc√™ tem login/senha para o site TJSP? Se sim, use a Op√ß√£o 1 (muito mais simples).

Se n√£o tiver, precisamos investigar como fazer o Selenium Grid aceitar certificados, o que pode ser bem complexo.

OPCAO 2 √© a unica op√ß√£o 
